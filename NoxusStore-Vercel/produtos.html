<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nossos Produtos - Noxus Store</title>
    <link rel="icon" href="https://cdn.ereemby.com/attachments/17624761158193205imagem.png" type="image/png">
    
    <style>
        :root {
            --cor-fundo-principal: #0a0a0a; --cor-roxo-claro: #9333ea; --cor-roxo-escuro: #6b21a8;
            --cor-texto-principal: #ffffff; --cor-texto-secundario: #a0a0a0; --cor-caixa-produto: #121212;
            --cor-borda-caixa: #222; --cor-tag-normal: #3b82f6; --cor-tag-exclusivo: #e11d48;
            --cor-tag-compartilhado: #16a34a; --espacamento-padrao: 20px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--cor-fundo-principal); color: var(--cor-texto-principal); overflow-x: hidden; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 var(--espacamento-padrao); width: 100%; }
        .header { padding: var(--espacamento-padrao) 0; height: 80px; width: 100%; }
        .header .container { display: flex; justify-content: space-between; align-items: center; height: 100%; }
        .logo-section { display: flex; align-items: center; text-decoration: none; color: var(--cor-texto-principal); }
        .logo-section img { height: 40px; margin-right: 10px; }
        .logo-section span { font-size: 1.8rem; font-weight: 700; }
        /* --- Botão Ativar Acesso --- */
        .activate-button {
            background-color: var(--cor-roxo-claro);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .activate-button:hover { background-color: var(--cor-roxo-escuro); }
        #key-status { font-size: 0.8rem; color: var(--cor-tag-compartilhado); margin-top: 5px; text-align: right; }

        .welcome-header { padding: 30px 0; }
        .welcome-header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 5px; }
        .welcome-header p { font-size: 1.2rem; color: var(--cor-texto-secundario); }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; padding-bottom: 50px; }
        .product-card { background-color: var(--cor-caixa-produto); border: 1px solid var(--cor-borda-caixa); border-radius: 10px; overflow: hidden; transition: border-color 0.3s ease; }
        .product-card:hover { border-color: var(--cor-roxo-claro); }
        .product-header-image { height: 120px; width: 100%; background-size: cover; background-position: center; display: flex; align-items: flex-end; padding: 15px; position: relative; background-color: #2a2a2a; }
        .product-logo { width: 64px; height: 64px; background-size: contain; background-position: center; background-repeat: no-repeat; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.4); position: absolute; bottom: -32px; left: 20px; border: 2px solid #333; background-color: #111; }
        .product-content { padding: 20px; padding-top: 45px; }
        .product-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 8px; }
        .product-description { font-size: 0.95rem; color: var(--cor-texto-secundario); min-height: 40px; margin-bottom: 15px; }
        .product-tags { display: flex; gap: 8px; margin-bottom: 20px; }
        .product-tags span { font-size: 0.8rem; font-weight: 500; padding: 4px 10px; border-radius: 20px; color: white; }
        .tag-normal { background-color: var(--cor-tag-normal); }
        .tag-exclusivo { background-color: var(--cor-tag-exclusivo); }
        .tag-compartilhado { background-color: var(--cor-tag-compartilhado); }
        .product-button { display: block; width: 100%; padding: 12px; border-radius: 5px; font-weight: 600; font-size: 1rem; text-align: center; text-decoration: none; transition: background-color 0.3s ease, border-color 0.3s ease; background-color: var(--cor-roxo-claro); color: var(--cor-texto-principal); border: 1px solid var(--cor-roxo-claro); cursor: pointer; }
        .product-button:hover { background-color: var(--cor-roxo-escuro); border-color: var(--cor-roxo-escuro); }
        .footer { text-align: center; padding: 40px 20px; margin-top: 50px; background-color: #111; border-top: 1px solid var(--cor-borda-caixa); }

        /* --- CSS DO MODAL DE ATIVAR CHAVE --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(5px); padding: 20px; }
        .modal-content { background: #1a1a1a; color: var(--cor-texto-principal); padding: 30px; border-radius: 10px; width: 100%; max-width: 500px; text-align: left; box-shadow: 0 5px 25px rgba(0,0,0,0.5); border: 1px solid var(--cor-roxo-escuro); }
        .modal-content h2 { text-align: center; margin-bottom: 25px; color: var(--cor-roxo-claro); }
        #modal-title-key { text-align: center; margin-bottom: 25px; color: var(--cor-roxo-claro); }
        .product-field { margin-bottom: 15px; }
        .product-field label { display: block; font-size: 0.9rem; font-weight: 600; color: var(--cor-texto-secundario); margin-bottom: 5px; }
        .product-data-container { display: flex; gap: 10px; }
        .product-data { flex-grow: 1; background-color: #0a0a0a; border: 1px solid var(--cor-borda-caixa); padding: 10px 12px; border-radius: 5px; font-family: monospace; font-size: 1rem; color: var(--cor-texto-principal); white-space: pre-wrap; word-break: break-all; min-height: 40px; }
        .modal-input { width: 100%; padding: 12px; border-radius: 5px; border: 1px solid #333; background-color: #0a0a0a; color: var(--cor-texto); font-size: 1rem; }
        .copy-button { flex-shrink: 0; background-color: var(--cor-roxo-claro); color: white; border: none; border-radius: 5px; padding: 0 15px; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; }
        .copy-button:hover { background-color: var(--cor-roxo-escuro); }
        .modal-button-group { display: flex; gap: 10px; margin-top: 20px; }
        .modal-button { flex-grow: 1; padding: 12px 25px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease; }
        .modal-button-primary { background-color: var(--cor-roxo-claro); color: white; }
        .modal-button-primary:hover { background-color: var(--cor-roxo-escuro); }
        .modal-button-secondary { background-color: #333; color: white; }
        .modal-button-secondary:hover { background-color: #444; }
        #modal-message { margin-top: 15px; font-weight: 600; text-align: center; }
    </style>
</head>
<body>

    <header class="header">
        <div class="container">
            <a href="index.html" class="logo-section">
                <img src="https://cdn.ereemby.com/attachments/17624761158193205imagem.png" alt="Noxus Store Logo">
                <span>Noxus Store</span>
            </a>
            <div>
                <button class="activate-button" onclick="openKeyModal()">Ativar Acesso</button>
                <div id="key-status">Não Ativado</div>
            </div>
        </div>
    </header>

    <main class="container">
        
        <div class="welcome-header">
            <h1>Bem-vindo de volta!</h1>
            <p>Escolha um produto para começar</p>
        </div>

        <div class="product-grid">
            <!-- Produto 1 (Premiere) -->
            <div class="product-card">
                <div class="product-header-image" style="background-image: url('https://cdn.ereemby.com/attachments/17379981324225009imagem.jpeg');">
                    <div class="product-logo" style="background-image: url('https://cdn.ereemby.com/attachments/17379981324225009imagem.jpeg'); background-color: #000;"></div>
                </div>
                <div class="product-content">
                    <h3 class="product-title">Premiere Premium</h3>
                    <p class="product-description">Seu P não grita gol quem tá sem pacote!</p>
                    <div class="product-tags">
                        <span class="tag-normal">Normal</span>
                        <span class="tag-compartilhado">Compartilhado</span>
                    </div>
                    <button class="product-button" onclick="gerarProduto('premiere')">Gerar</button>
                </div>
            </div>
            <!-- Outros produtos aqui... (Crunchyroll, Disney, etc.) -->
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Noxus Store. Todos os direitos reservados.</p>
    </footer>

    <!-- ============================================= -->
    <!-- HTML DO MODAL DE ENTREGA DO PRODUTO (GERAR)   -->
    <!-- ============================================= -->
    <div class="modal-overlay" id="product-modal">
        <div class="modal-content">
            <h2 id="modal-title-product">Seu Produto Foi Gerado!</h2>
            <div class="product-field">
                <label for="product-email">Email</label>
                <div class="product-data-container">
                    <div id="product-email" class="product-data"></div>
                    <button id="copy-email" class="copy-button" onclick="copiarTexto('product-email', 'copy-email')">Copiar</button>
                </div>
            </div>
            <div class="product-field">
                <label for="product-pass">Senha</label>
                <div class="product-data-container">
                    <div id="product-pass" class="product-data"></div>
                    <button id="copy-pass" class="copy-button" onclick="copiarTexto('product-pass', 'copy-pass')">Copiar</button>
                </div>
            </div>
            <div class="product-field">
                <label for="product-inst">Instrução</label>
                <div class="product-data-container">
                    <div id="product-inst" class="product-data"></div>
                    <button id="copy-inst" class="copy-button" onclick="copiarTexto('product-inst', 'copy-inst')">Copiar</button>
                </div>
            </div>
            <div class="modal-button-group">
                <button class="modal-button modal-button-secondary" onclick="fecharModal('product-modal')">Fechar</button>
            </div>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- HTML DO MODAL DE ATIVAR CHAVE                 -->
    <!-- ============================================= -->
    <div class="modal-overlay" id="key-modal">
        <div class="modal-content">
            <h2 id="modal-title-key">Ativar Chave de Acesso</h2>
            <div class="product-field">
                <label for="key-input">Sua Chave</label>
                <input type="text" id="key-input" class="modal-input" placeholder="Cole sua chave aqui...">
            </div>
            <p id="modal-message"></p>
            <div class="modal-button-group">
                <button class="modal-button modal-button-secondary" onclick="fecharModal('key-modal')">Cancelar</button>
                <button class="modal-button modal-button-primary" id="activate-key-btn" onclick="handleActivateKey()">Ativar</button>
            </div>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- JAVASCRIPT DO CLIENTE                         -->
    <!-- ============================================= -->
    <script>
        
        // -----------------------------------------------------------------
        // 
        // ALERTA: NÃO COLOQUE SEU ESTOQUE REAL AQUI. ELE SERÁ ROUBADO.
        // 
        var estoqueDB = {
            'premiere': [
                'email1_premiere@teste.com:senha123:Instrução do Premiere 1',
                'email2_premiere@teste.com:senha456:Instrução do Premiere 2',
            ],
            'crunchyroll': [
                'email1_crunchy@teste.com:crunchy123:Não altere o perfil, use o seu.',
            ]
            // Adicione os outros estoques aqui
        };
        // -----------------------------------------------------------------

        // Elementos dos Modais
        const productModal = document.getElementById('product-modal');
        const keyModal = document.getElementById('key-modal');
        const keyStatusEl = document.getElementById('key-status');
        const modalMessageEl = document.getElementById('modal-message');

        // Elementos do Modal de Produto
        const modalTitleProduct = document.getElementById('modal-title-product');
        const productEmail = document.getElementById('product-email');
        const productPass = document.getElementById('product-pass');
        const productInst = document.getElementById('product-inst');
        const copyEmailBtn = document.getElementById('copy-email');
        const copyPassBtn = document.getElementById('copy-pass');
        const copyInstBtn = document.getElementById('copy-inst');

        // --- LÓGICA DA CHAVE DE ACESSO ---

        // Verifica o status da chave ao carregar a página
        document.addEventListener('DOMContentLoaded', checkKeyStatus);

        function checkKeyStatus() {
            const keyData = JSON.parse(localStorage.getItem('accessKey'));
            if (keyData && new Date(keyData.expiresAt) > new Date()) {
                // Chave válida e não expirada
                const expiryDate = new Date(keyData.expiresAt).toLocaleDateString('pt-BR');
                keyStatusEl.innerText = `Ativado! Expira em: ${expiryDate}`;
                keyStatusEl.style.color = 'var(--cor-tag-compartilhado)';
            } else {
                // Sem chave ou chave expirada
                keyStatusEl.innerText = 'Não Ativado';
                keyStatusEl.style.color = 'var(--cor-tag-exclusivo)';
                localStorage.removeItem('accessKey');
            }
        }

        function openKeyModal() {
            modalMessageEl.innerText = '';
            document.getElementById('key-input').value = '';
            keyModal.style.display = 'flex';
        }

        async function handleActivateKey() {
            const key = document.getElementById('key-input').value;
            const btn = document.getElementById('activate-key-btn');
            if (!key) {
                modalMessageEl.innerText = 'Por favor, insira uma chave.';
                modalMessageEl.style.color = 'var(--cor-tag-exclusivo)';
                return;
            }

            btn.disabled = true;
            btn.innerText = 'Validando...';
            modalMessageEl.innerText = '';

            try {
                const response = await fetch('/.netlify/functions/client-api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'validate_key', key: key })
                });

                const data = await response.json();

                if (response.ok) {
                    // Chave válida! Salva no localStorage
                    const keyData = {
                        key: key,
                        expiresAt: data.expiresAt
                    };
                    localStorage.setItem('accessKey', JSON.stringify(keyData));
                    
                    modalMessageEl.innerText = 'Chave ativada com sucesso!';
                    modalMessageEl.style.color = 'var(--cor-tag-compartilhado)';
                    
                    checkKeyStatus(); // Atualiza o status no header
                    setTimeout(() => fecharModal('key-modal'), 1500);

                } else {
                    throw new Error(data.error);
                }
            } catch (err) {
                modalMessageEl.innerText = err.message;
                modalMessageEl.style.color = 'var(--cor-tag-exclusivo)';
            } finally {
                btn.disabled = false;
                btn.innerText = 'Ativar';
            }
        }

        // --- LÓGICA DE GERAR PRODUTO ---

        function gerarProduto(produtoId) {
            // 1. Verifica se tem uma chave de acesso válida
            const keyData = JSON.parse(localStorage.getItem('accessKey'));
            if (!keyData || new Date(keyData.expiresAt) < new Date()) {
                // Se não tem chave ou expirou, abre o modal de ativar chave
                openKeyModal();
                return;
            }

            // 2. Se tem chave, continua para gerar o produto (lógica antiga)
            
            // Reseta o texto dos botões de copiar
            copyEmailBtn.innerText = 'Copiar';
            copyPassBtn.innerText = 'Copiar';
            copyInstBtn.innerText = 'Copiar';

            if (estoqueDB[produtoId] && estoqueDB[produtoId].length > 0) {
                var produtoGerado = estoqueDB[produtoId].shift(); 
                var partes = produtoGerado.split(':');
                
                modalTitleProduct.innerText = "Seu Produto Foi Gerado!";
                productEmail.innerText = partes[0];
                productPass.innerText = partes[1];
                productInst.innerText = partes[2];
            } else {
                modalTitleProduct.innerText = "Estoque Esgotado!";
                productEmail.innerText = "N/A";
                productPass.innerText = "N/A";
                productInst.innerText = "Entre em contato com o suporte.";
            }

            // Mostra o modal do produto
            productModal.style.display = 'flex';
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function copiarTexto(elementId, buttonId) {
            const texto = document.getElementById(elementId).innerText;
            const botao = document.getElementById(buttonId);

            if (navigator.clipboard) {
                navigator.clipboard.writeText(texto).then(() => {
                    botao.innerText = 'Copiado!';
                });
            } else {
                // Fallback (pode não funcionar)
                const textArea = document.createElement('textarea');
                textArea.value = texto;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                botao.innerText = 'Copiado!';
            }
        }
    </script>
</body>
</html>